{"ast":null,"code":"var _jsxFileName = \"/Users/markheij/ipmedth_airsupport/frontend/src/steps/Step_7_Node_Add.js\";\nimport React, { Component } from 'react';\nimport QrReader from 'react-qr-reader';\nimport \"../containers/Home.css\";\nimport { Container, Typography, Box, Grid, SnackbarContent, Snackbar, TextField, Button, Input, withStyles } from '@material-ui/core';\nimport \"../steps/Step.css\";\nimport firebase from \"firebase\";\nimport Firebase from \"firebase\";\nlet isScanned = false;\nlet nid;\nlet xn;\nlet yn;\n\nif (navigator.geolocation) {\n  navigator.geolocation.getCurrentPosition(function (position) {\n    yn = position.coords.latitude;\n    xn = position.coords.longitude;\n  });\n} else {}\n\nexport default class step8 extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      result: ''\n    };\n\n    this.handleClose = () => {\n      this.setState({\n        isOpen: false\n      });\n    };\n\n    this.handleScan = data => {\n      var user = Firebase.auth().currentUser;\n\n      if (data) {\n        //try to parse JSON (if not JSON then bad QR code)\n        try {\n          var nodedata = JSON.parse(data);\n          console.log(nodedata); //if JSON check for quantified object (if not then bad QR code)\n\n          if (nodedata.hasOwnProperty(\"quantified\") || nodedata.hasOwnProperty(\"Quantified\")) {\n            console.log(\"Quantified\");\n            nid = nodedata.quantified.id;\n\n            if (user) {\n              const uid = user.uid;\n              Firebase.firestore().collection(uid).doc(nid).get().then(docSnapshot => {\n                if (docSnapshot.exists) {\n                  this.setState({\n                    result: \"Node was already added. Try another one!\"\n                  });\n                } else {\n                  Firebase.firestore().collection(uid).doc(nid).set(nodedata).then(function () {\n                    console.log(\"Written to firestore\");\n                  });\n                  this.setState({\n                    result: \"Node Scanned!\"\n                  });\n                  isScanned = true;\n                  console.log(isScanned);\n                }\n              });\n            } else {\n              console.log(\"No user\");\n              this.props.history.push(\"/login\");\n            }\n          } else {\n            this.setState({\n              isOpen: true\n            });\n          }\n        } catch (e) {\n          console.error(e);\n          this.setState({\n            result: \"Can't find node QR code\"\n          });\n        }\n      }\n    };\n\n    this.handleSubmit = event => {\n      event.preventDefault();\n      const nodesGroup = this.state.nodesGroup;\n      const nodesName = this.state.nodesName;\n      var user = Firebase.auth().currentUser;\n\n      if (user) {\n        const uid = user.uid;\n        console.log(\"uid: \" + uid);\n        console.log(\"nid: \" + nid);\n        Firebase.firestore().collection(uid).doc(nid).get().then(docSnapshot => {\n          if (docSnapshot.exists) {\n            Firebase.firestore().collection(uid).doc(nid).update({\n              name: nodesName,\n              group: nodesGroup,\n              x: xn,\n              y: yn,\n              z: 1\n            }).then(function () {\n              console.log(\"Written to firestore\");\n            }); //move to next step\n          } else {}\n        });\n      } else {\n        console.log(\"No user\");\n        this.props.history.push(\"/login\");\n      }\n    };\n\n    this.handleError = err => {\n      console.error(err);\n      this.setState({\n        isOpen: true\n      });\n      this.setState({\n        result: \"Something went wrong! Did you use the QR code?\"\n      });\n    };\n\n    this.state = {\n      nodesName: '',\n      nodesGroup: '',\n      isOpen: false\n    };\n    this.handleChangeName = this.handleChangeName.bind(this);\n    this.handleChangeGroup = this.handleChangeGroup.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  handleChangeName(event) {\n    this.setState({\n      nodesName: event.target.value\n    });\n  }\n\n  handleChangeGroup(event) {\n    this.setState({\n      nodesGroup: event.target.value\n    });\n  }\n\n  render() {\n    return React.createElement(Container, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171\n      },\n      __self: this\n    }, React.createElement(Box, {\n      m: 1,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172\n      },\n      __self: this\n    }, React.createElement(Typography, {\n      variant: \"overline\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173\n      },\n      __self: this\n    }, \"Installation \\u279C Nodes\"), React.createElement(Typography, {\n      variant: \"h4\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176\n      },\n      __self: this\n    }, \"Nodes\"), React.createElement(Typography, {\n      display: \"block\",\n      variant: \"body1\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177\n      },\n      __self: this\n    }, !isScanned && \"Scan the QR code to add the node to the system\", isScanned && \"Give the node a name and assign it to a group\")), !isScanned && React.createElement(Box, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183\n      },\n      __self: this\n    }, React.createElement(QrReader, {\n      delay: 300,\n      onError: this.handleError,\n      onScan: this.handleScan,\n      facingMode: \"environment\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184\n      },\n      __self: this\n    }), React.createElement(Snackbar, {\n      open: this.isOpen,\n      autoHideDuration: 2000,\n      onClose: this.handleClose,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190\n      },\n      __self: this\n    }, React.createElement(SnackbarContent, {\n      message: this.state.result,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195\n      },\n      __self: this\n    }))), isScanned && React.createElement(Box, {\n      m: 1,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201\n      },\n      __self: this\n    }, React.createElement(\"form\", {\n      onSubmit: this.handleSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203\n      },\n      __self: this\n    }, React.createElement(Box, {\n      m: 1,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204\n      },\n      __self: this\n    }, React.createElement(Typography, {\n      component: \"h1\",\n      variant: \"h6\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205\n      },\n      __self: this\n    }, \"Node Name\"), React.createElement(Input, {\n      name: \"nodesName\",\n      placeholder: \"Node name\",\n      id: \"nodesName\",\n      fullWidth: true,\n      margin: \"normal\",\n      required: true,\n      type: \"text\",\n      autoFocus: true,\n      onChange: this.handleChangeName,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206\n      },\n      __self: this\n    })), React.createElement(Box, {\n      m: 1,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218\n      },\n      __self: this\n    }, React.createElement(Typography, {\n      component: \"h1\",\n      variant: \"h6\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219\n      },\n      __self: this\n    }, \"Node Group\"), React.createElement(Input, {\n      name: \"nodesGroup\",\n      placeholder: \"Node group\",\n      id: \"nodesGroup\",\n      fullWidth: true,\n      margin: \"normal\",\n      required: true,\n      type: \"text\",\n      onChange: this.handleChangeGroup,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 220\n      },\n      __self: this\n    }))), React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232\n      },\n      __self: this\n    }, React.createElement(Button, {\n      type: \"submit\",\n      fullWidth: true,\n      variant: \"contained\",\n      color: \"primary\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233\n      },\n      __self: this\n    }, \"Save\")))));\n  }\n\n}","map":{"version":3,"sources":["/Users/markheij/ipmedth_airsupport/frontend/src/steps/Step_7_Node_Add.js"],"names":["React","Component","QrReader","Container","Typography","Box","Grid","SnackbarContent","Snackbar","TextField","Button","Input","withStyles","firebase","Firebase","isScanned","nid","xn","yn","navigator","geolocation","getCurrentPosition","position","coords","latitude","longitude","step8","constructor","props","state","result","handleClose","setState","isOpen","handleScan","data","user","auth","currentUser","nodedata","JSON","parse","console","log","hasOwnProperty","quantified","id","uid","firestore","collection","doc","get","then","docSnapshot","exists","set","history","push","e","error","handleSubmit","event","preventDefault","nodesGroup","nodesName","update","name","group","x","y","z","handleError","err","handleChangeName","bind","handleChangeGroup","target","value","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport QrReader from 'react-qr-reader'\nimport \"../containers/Home.css\";\nimport {\n    Container,\n    Typography,\n    Box,\n    Grid,\n    SnackbarContent,\n    Snackbar,\n    TextField,\n    Button,\n    Input,\n    withStyles\n} from '@material-ui/core';\nimport \"../steps/Step.css\"\nimport firebase from \"firebase\";\nimport Firebase from \"firebase\";\n\n\nlet isScanned = false;\nlet nid;\nlet xn;\nlet yn;\n\nif (navigator.geolocation) {\n    navigator.geolocation.getCurrentPosition(function (position) {\n        yn = position.coords.latitude;\n        xn = position.coords.longitude;\n\n    });\n}else {\n\n}\n\nexport default class step8 extends Component {\n\n    constructor(props) {\n        super(props);\n        this.state = {nodesName: '', nodesGroup: '', isOpen: false}\n        this.handleChangeName = this.handleChangeName.bind(this);\n        this.handleChangeGroup = this.handleChangeGroup.bind(this);\n        this.handleSubmit = this.handleSubmit.bind(this);\n    }\n\n\n    state = {\n        result: ''\n    };\n\n    handleChangeName(event){\n      this.setState({nodesName: event.target.value});\n    }\n\n    handleChangeGroup(event){\n      this.setState({nodesGroup: event.target.value});\n    }\n\n    handleClose = () =>{\n      this.setState({isOpen:false})\n    }\n\n    handleScan = data => {\n        var user = Firebase.auth().currentUser;\n        if (data) {\n            //try to parse JSON (if not JSON then bad QR code)\n            try {\n                var nodedata = JSON.parse(data);\n                console.log(nodedata);\n                //if JSON check for quantified object (if not then bad QR code)\n                if(nodedata.hasOwnProperty(\"quantified\") || nodedata.hasOwnProperty(\"Quantified\")){\n                    console.log(\"Quantified\");\n\n                    nid = nodedata.quantified.id;\n\n                    if (user) {\n                        const uid = user.uid;\n                        Firebase.firestore().collection(uid).doc(nid).get()\n                            .then((docSnapshot) =>{\n                                if (docSnapshot.exists){\n                                    this.setState({\n                                        result: \"Node was already added. Try another one!\"\n                                    });\n\n                                }else {\n                                    Firebase.firestore().collection(uid).doc(nid).set(nodedata).then(function () {\n                                        console.log(\"Written to firestore\");\n                                    });\n                                    this.setState({\n                                        result: \"Node Scanned!\"\n                                    });\n                                    isScanned = true;\n                                    console.log(isScanned)\n                                }\n                            });\n\n\n                    }else{\n                        console.log(\"No user\");\n                        this.props.history.push(\"/login\")\n                    }\n                }else{\n                    this.setState({\n                        isOpen: true\n                    });\n                }\n            }catch (e) {\n                console.error(e);\n                this.setState({\n                    result: \"Can't find node QR code\"\n                });\n            }\n        }\n    };\n\n\n\n\n    handleSubmit = (event) =>{\n        event.preventDefault();\n        const nodesGroup = this.state.nodesGroup;\n        const nodesName = this.state.nodesName;\n\n\n        var user = Firebase.auth().currentUser;\n        if (user) {\n            const uid = user.uid;\n            console.log(\"uid: \"+ uid);\n            console.log(\"nid: \" + nid);\n            Firebase.firestore().collection(uid).doc(nid).get()\n                .then((docSnapshot) =>{\n                    if (docSnapshot.exists){\n                        Firebase.firestore().collection(uid).doc(nid).update({\n                            name: nodesName,\n                            group: nodesGroup,\n                            x: xn,\n                            y: yn,\n                            z: 1\n                        }).then(function () {\n                            console.log(\"Written to firestore\");\n                        });\n\n                        //move to next step\n\n                    }else {\n\n\n                    }\n                });\n\n\n        }else{\n            console.log(\"No user\");\n            this.props.history.push(\"/login\")\n        }\n    }\n\n\n\n\n    handleError = err => {\n        console.error(err);\n        this.setState({isOpen:true})\n        this.setState({\n            result: \"Something went wrong! Did you use the QR code?\"\n        })\n    };\n\n    render() {\n        return (\n            <Container>\n                <Box m={1}>\n                        <Typography variant=\"overline\">\n                          Installation &#10140; Nodes\n                        </Typography>\n                        <Typography variant=\"h4\">Nodes</Typography>\n                        <Typography display=\"block\" variant=\"body1\">\n                            {!isScanned && (\"Scan the QR code to add the node to the system\")}\n                            {isScanned && (\"Give the node a name and assign it to a group\")}\n                        </Typography>\n                    </Box>\n                    {!isScanned && (\n                        <Box>\n                                <QrReader\n                                    delay={300}\n                                    onError={this.handleError}\n                                    onScan={this.handleScan}\n                                    facingMode={\"environment\"}\n                                />\n                                <Snackbar\n                                  open={this.isOpen}\n                                  autoHideDuration={2000}\n                                  onClose={this.handleClose}\n                                >\n                                <SnackbarContent\n                                  message={this.state.result}\n                                />\n                                </Snackbar>\n                        </Box>)}\n                        {isScanned && (\n                    <Box m={1}>\n                        <form onSubmit={this.handleSubmit}>\n                        <div>\n                          <Box m={1}>\n                            <Typography component=\"h1\" variant=\"h6\">Node Name</Typography>\n                          <Input\n                                name=\"nodesName\"\n                                placeholder=\"Node name\"\n                                id=\"nodesName\"\n                                fullWidth\n                                margin=\"normal\"\n                                required\n                                type=\"text\"\n                                autoFocus\n                                onChange={this.handleChangeName}\n                            />\n                        </Box>\n                          <Box m={1}>\n                          <Typography component=\"h1\" variant=\"h6\">Node Group</Typography>\n                          <Input\n                                name=\"nodesGroup\"\n                                placeholder=\"Node group\"\n                                id=\"nodesGroup\"\n                                fullWidth\n                                margin=\"normal\"\n                                required\n                                type=\"text\"\n                                onChange={this.handleChangeGroup}\n                            />\n                        </Box>\n                        </div>\n                        <div>\n                            <Button type=\"submit\"\n                                    fullWidth\n                                    variant=\"contained\"\n                                    color=\"primary\">\n                                Save\n                            </Button>\n                        </div>\n                        </form>\n                    </Box>)}\n\n            </Container>\n\n        )\n    }\n}\n"]},"metadata":{},"sourceType":"module"}